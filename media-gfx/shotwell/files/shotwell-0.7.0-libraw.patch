diff -urN shotwell-0.7.0.old/Makefile shotwell-0.7.0/Makefile
--- shotwell-0.7.0.old/Makefile	2010-08-21 02:27:06.000000000 +0200
+++ shotwell-0.7.0/Makefile	2010-08-24 10:30:22.652830088 +0200
@@ -135,7 +135,7 @@
 	FixedKeyFile.vapi \
 	ExtendedPosix.vapi \
 	LConv.vapi \
-	libraw.vapi \
+	libraw_r.vapi \
 	gdk-none.vapi
 
 RESOURCE_FILES = \
@@ -268,10 +268,8 @@
 	glib-2.0 \
 	libexif \
 	sqlite3 \
-	gexiv2
-
-LIBRAW_PKG = \
-	libraw
+	gexiv2 \
+	libraw_r
 
 ifdef LINUX
 EXT_PKGS += \
@@ -286,15 +284,14 @@
 	gdk-x11-2.0
 endif
 
-# libraw is handled separately (see note below); when libraw-config is no longer needed, the version
-# should be added to this list
 EXT_PKG_VERSIONS = \
 	gee-1.0 >= 0.5.0 \
 	gtk+-2.0 >= 2.18.0 \
 	glib-2.0 >= 2.24.0 \
 	libexif >= 0.6.16 \
 	sqlite3 >= 3.5.9 \
-	gexiv2 >= 0.2.0
+	gexiv2 >= 0.2.0 \
+	libraw_r >= 0.9.0
 
 LIBRAW_VERSION = \
 	0.9.0
@@ -311,7 +308,7 @@
 	dbus-glib-1 >= 0.80
 endif
 
-PKGS = $(EXT_PKGS) $(LOCAL_PKGS) $(LIBRAW_PKG)
+PKGS = $(EXT_PKGS) $(LOCAL_PKGS)
 
 ifndef BUILD_DIR
 BUILD_DIR=src
@@ -342,7 +339,7 @@
 DIST_FILES = Makefile configure minver $(EXPANDED_SRC_FILES) $(EXPANDED_VAPI_FILES) \
 	$(EXPANDED_SRC_HEADER_FILES) $(EXPANDED_RESOURCE_FILES) $(TEXT_FILES) $(EXPANDED_ICON_FILES) \
 	$(EXPANDED_SYS_INTEGRATION_FILES) $(EXPANDED_PO_FILES) po/shotwell.pot windows/install-deps \
-	windows/shotwell.rc windows/winstall.iss src/windows.c src/GConf.vala libraw-config \
+	windows/shotwell.rc windows/winstall.iss src/windows.c src/GConf.vala \
 	$(EXPANDED_HELP_FILES) $(EXPANDED_HELP_IMAGES) apport/shotwell.py
 
 DIST_TAR = $(PROGRAM)-$(VERSION).tar
@@ -385,14 +382,9 @@
 CFLAGS += -DG_UDEV_API_IS_SUBJECT_TO_CHANGE
 endif
 
-# Packaged libraw is not widely available, so we must fake what would be in its .pc file
-# if not available.
-ifdef LINUX
-LIBRAW_CONFIG=./libraw-config
-endif
-
-ifdef WINDOWS
-LIBRAW_CONFIG=./libraw-config --windows
+ifneq (,$(findstring fopenmp,$(shell pkg-config --cflags libraw_r)))
+# If libraw is built with OpenMP support, we'll need this.
+CFLAGS += -fopenmp
 endif
 
 $(LANG_STAMP): $(EXPANDED_PO_FILES)
@@ -523,10 +515,6 @@
 else ifdef EXT_PKGS
 	@pkg-config --print-errors --exists $(EXT_PKGS)
 endif
-# Check for libraw manually, but not on Windows, where install-deps is used
-ifndef WINDOWS
-	@$(LIBRAW_CONFIG) --exists=$(LIBRAW_VERSION)
-endif
 endif
 	@ type msgfmt > /dev/null || ( echo 'msgfmt (usually found in the gettext package) is missing and is required to build Shotwell. ' ; exit 1 )
 	mkdir -p $(BUILD_DIR)
@@ -544,15 +532,15 @@
 	@
 
 $(EXPANDED_OBJ_FILES): %.o: %.c $(CONFIG_IN) Makefile
-	$(CC) -c $(VALA_CFLAGS) `$(LIBRAW_CONFIG) --cflags` $(CFLAGS) -o $@ $<
+	$(CC) -c $(VALA_CFLAGS) $(CFLAGS) -o $@ $<
 
 $(PROGRAM): $(EXPANDED_OBJ_FILES) $(RESOURCES) $(LANG_STAMP)
-	$(CC) $(EXPANDED_OBJ_FILES) $(CFLAGS) $(RESOURCES) $(VALA_LDFLAGS) `$(LIBRAW_CONFIG) --libs` $(EXPORT_FLAGS) -o $@
+	$(CC) $(EXPANDED_OBJ_FILES) $(CFLAGS) $(RESOURCES) $(VALA_LDFLAGS) $(EXPORT_FLAGS) -o $@
 
 glade: lib$(PROGRAM).so
 
 lib$(PROGRAM).so: $(EXPANDED_OBJ_FILES) $(RESOURCES) $(LANG_STAMP)
-	$(CC) $(EXPANDED_OBJ_FILES) $(CFLAGS) $(RESOURCES) $(VALA_LDFLAGS) `$(LIBRAW_CONFIG) --libs` $(EXPORT_FLAGS) -shared -o $@
+	$(CC) $(EXPANDED_OBJ_FILES) $(CFLAGS) $(RESOURCES) $(VALA_LDFLAGS) $(EXPORT_FLAGS) -shared -o $@
 
 shotwell-setup-$(VERSION).exe: $(PROGRAM) windows/winstall.iss
 	iscc windows\winstall.iss
